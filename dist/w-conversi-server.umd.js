/*!
 * w-conversi-server v1.0.18
 * (c) 2018-2021 yuda-lyu(semisphere)
 * Released under the MIT License.
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("@hapi/hapi"),require("@hapi/inert"),require("socket.io"),require("events")):"function"==typeof define&&define.amd?define(["@hapi/hapi","@hapi/inert","socket.io","events"],r):(t="undefined"!=typeof globalThis?globalThis:t||self)["w-conversi-server"]=r(t["@hapi/hapi"],t["@hapi/inert"],t.socket.io,t.events)}(this,(function(t,r,e,n){"use strict";var o=Array.isArray,i="object"==typeof global&&global&&global.Object===Object&&global,u="object"==typeof self&&self&&self.Object===Object&&self,a=i||u||Function("return this")(),c=a.Symbol,f=Object.prototype,s=f.hasOwnProperty,l=f.toString,p=c?c.toStringTag:void 0;var h=Object.prototype.toString;var d="[object Null]",y="[object Undefined]",v=c?c.toStringTag:void 0;function g(t){return null==t?void 0===t?y:d:v&&v in Object(t)?function(t){var r=s.call(t,p),e=t[p];try{t[p]=void 0;var n=!0}catch(t){}var o=l.call(t);return n&&(r?t[p]=e:delete t[p]),o}(t):function(t){return h.call(t)}(t)}function b(t){return null!=t&&"object"==typeof t}var _="[object Symbol]";function j(t){return"symbol"==typeof t||b(t)&&g(t)==_}var m=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,w=/^\w*$/;function A(t){var r=typeof t;return null!=t&&("object"==r||"function"==r)}var O="[object AsyncFunction]",x="[object Function]",S="[object GeneratorFunction]",U="[object Proxy]";function B(t){if(!A(t))return!1;var r=g(t);return r==x||r==S||r==O||r==U}var z,T=a["__core-js_shared__"],E=(z=/[^.]+$/.exec(T&&T.keys&&T.keys.IE_PROTO||""))?"Symbol(src)_1."+z:"";var C=Function.prototype.toString;var I=/^\[object .+?Constructor\]$/,P=Function.prototype,$=Object.prototype,M=P.toString,k=$.hasOwnProperty,F=RegExp("^"+M.call(k).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function R(t){return!(!A(t)||(r=t,E&&E in r))&&(B(t)?F:I).test(function(t){if(null!=t){try{return C.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var r}function N(t,r){var e=function(t,r){return null==t?void 0:t[r]}(t,r);return R(e)?e:void 0}var H=N(Object,"create");var q=Object.prototype.hasOwnProperty;var D=Object.prototype.hasOwnProperty;function L(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}function W(t,r){return t===r||t!=t&&r!=r}function G(t,r){for(var e=t.length;e--;)if(W(t[e][0],r))return e;return-1}L.prototype.clear=function(){this.__data__=H?H(null):{},this.size=0},L.prototype.delete=function(t){var r=this.has(t)&&delete this.__data__[t];return this.size-=r?1:0,r},L.prototype.get=function(t){var r=this.__data__;if(H){var e=r[t];return"__lodash_hash_undefined__"===e?void 0:e}return q.call(r,t)?r[t]:void 0},L.prototype.has=function(t){var r=this.__data__;return H?void 0!==r[t]:D.call(r,t)},L.prototype.set=function(t,r){var e=this.__data__;return this.size+=this.has(t)?0:1,e[t]=H&&void 0===r?"__lodash_hash_undefined__":r,this};var V=Array.prototype.splice;function J(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}J.prototype.clear=function(){this.__data__=[],this.size=0},J.prototype.delete=function(t){var r=this.__data__,e=G(r,t);return!(e<0)&&(e==r.length-1?r.pop():V.call(r,e,1),--this.size,!0)},J.prototype.get=function(t){var r=this.__data__,e=G(r,t);return e<0?void 0:r[e][1]},J.prototype.has=function(t){return G(this.__data__,t)>-1},J.prototype.set=function(t,r){var e=this.__data__,n=G(e,t);return n<0?(++this.size,e.push([t,r])):e[n][1]=r,this};var K=N(a,"Map");function Q(t,r){var e,n,o=t.__data__;return("string"==(n=typeof(e=r))||"number"==n||"symbol"==n||"boolean"==n?"__proto__"!==e:null===e)?o["string"==typeof r?"string":"hash"]:o.map}function X(t){var r=-1,e=null==t?0:t.length;for(this.clear();++r<e;){var n=t[r];this.set(n[0],n[1])}}X.prototype.clear=function(){this.size=0,this.__data__={hash:new L,map:new(K||J),string:new L}},X.prototype.delete=function(t){var r=Q(this,t).delete(t);return this.size-=r?1:0,r},X.prototype.get=function(t){return Q(this,t).get(t)},X.prototype.has=function(t){return Q(this,t).has(t)},X.prototype.set=function(t,r){var e=Q(this,t),n=e.size;return e.set(t,r),this.size+=e.size==n?0:1,this};var Y="Expected a function";function Z(t,r){if("function"!=typeof t||null!=r&&"function"!=typeof r)throw new TypeError(Y);var e=function(){var n=arguments,o=r?r.apply(this,n):n[0],i=e.cache;if(i.has(o))return i.get(o);var u=t.apply(this,n);return e.cache=i.set(o,u)||i,u};return e.cache=new(Z.Cache||X),e}Z.Cache=X;var tt,rt,et,nt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ot=/\\(\\)?/g,it=(tt=function(t){var r=[];return 46===t.charCodeAt(0)&&r.push(""),t.replace(nt,(function(t,e,n,o){r.push(n?o.replace(ot,"$1"):e||t)})),r},rt=Z(tt,(function(t){return 500===et.size&&et.clear(),t})),et=rt.cache,rt),ut=it;var at=1/0,ct=c?c.prototype:void 0,ft=ct?ct.toString:void 0;function st(t){if("string"==typeof t)return t;if(o(t))return function(t,r){for(var e=-1,n=null==t?0:t.length,o=Array(n);++e<n;)o[e]=r(t[e],e,t);return o}(t,st)+"";if(j(t))return ft?ft.call(t):"";var r=t+"";return"0"==r&&1/t==-at?"-0":r}function lt(t){return null==t?"":st(t)}function pt(t,r){return o(t)?t:function(t,r){if(o(t))return!1;var e=typeof t;return!("number"!=e&&"symbol"!=e&&"boolean"!=e&&null!=t&&!j(t))||w.test(t)||!m.test(t)||null!=r&&t in Object(r)}(t,r)?[t]:ut(lt(t))}var ht=1/0;function dt(t){if("string"==typeof t||j(t))return t;var r=t+"";return"0"==r&&1/t==-ht?"-0":r}function yt(t,r,e){var n=null==t?void 0:function(t,r){for(var e=0,n=(r=pt(r,t)).length;null!=t&&e<n;)t=t[dt(r[e++])];return e&&e==n?t:void 0}(t,r);return void 0===n?e:n}var vt=/\s/;var gt=/^\s+/;function bt(t){return t?t.slice(0,function(t){for(var r=t.length;r--&&vt.test(t.charAt(r)););return r}(t)+1).replace(gt,""):t}var _t=NaN,jt=/^[-+]0x[0-9a-f]+$/i,mt=/^0b[01]+$/i,wt=/^0o[0-7]+$/i,At=parseInt;function Ot(t){if("number"==typeof t)return t;if(j(t))return _t;if(A(t)){var r="function"==typeof t.valueOf?t.valueOf():t;t=A(r)?r+"":r}if("string"!=typeof t)return 0===t?t:+t;t=bt(t);var e=mt.test(t);return e||wt.test(t)?At(t.slice(2),e?2:8):jt.test(t)?_t:+t}var xt=1/0,St=17976931348623157e292;function Ut(t){return t?(t=Ot(t))===xt||t===-xt?(t<0?-1:1)*St:t==t?t:0:0===t?t:0}function Bt(t){var r=Ut(t),e=r%1;return r==r?e?r-e:r:0}function zt(t){return"[object String]"===Object.prototype.toString.call(t)}function Tt(t){return!(!zt(t)||""===t)}function Et(t){let r=!1;if(Tt(t))r=!isNaN(Number(t));else if(function(t){return"[object Number]"===Object.prototype.toString.call(t)}(t)){if(function(t){return t!=t}(t))return!1;r=!0}return r}function Ct(t){if(!Et(t))return 0;return Ut(t)}function It(t){return!!Et(t)&&(t=Ct(t),"number"==typeof(r=t)&&r==Bt(r));var r}var Pt=a.isFinite,$t=Math.min;var Mt=function(t){var r=Math[t];return function(t,e){if(t=Ot(t),(e=null==e?0:$t(Bt(e),292))&&Pt(t)){var n=(lt(t)+"e").split("e");return+((n=(lt(r(n[0]+"e"+(+n[1]+e)))+"e").split("e"))[0]+"e"+(+n[1]-e))}return r(t)}}("round"),kt=Mt;function Ft(t){if(!Et(t))return 0;t=Ct(t);let r=kt(t);return"0"===String(r)?0:r}function Rt(t){if(!It(t))return!1;return Ft(t)>0}function Nt(t,r,e){var n=-1,o=t.length;r<0&&(r=-r>o?0:o+r),(e=e>o?o:e)<0&&(e+=o),o=r>e?0:e-r>>>0,r>>>=0;for(var i=Array(o);++n<o;)i[n]=t[n+r];return i}var Ht=9007199254740991;function qt(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=Ht}function Dt(t){return null!=t&&qt(t.length)&&!B(t)}var Lt=9007199254740991,Wt=/^(?:0|[1-9]\d*)$/;function Gt(t,r){var e=typeof t;return!!(r=null==r?Lt:r)&&("number"==e||"symbol"!=e&&Wt.test(t))&&t>-1&&t%1==0&&t<r}function Vt(t,r,e){if(!A(e))return!1;var n=typeof r;return!!("number"==n?Dt(e)&&Gt(r,e.length):"string"==n&&r in e)&&W(e[r],t)}var Jt=Math.ceil,Kt=Math.max;var Qt=Array.prototype.join;function Xt(t,r){return null==t?"":Qt.call(t,r)}function Yt(t,r){for(var e=-1,n=null==t?0:t.length;++e<n&&!1!==r(t[e],e,t););return t}var Zt,tr=function(t,r,e){for(var n=-1,o=Object(t),i=e(t),u=i.length;u--;){var a=i[Zt?u:++n];if(!1===r(o[a],a,o))break}return t};function rr(t){return b(t)&&"[object Arguments]"==g(t)}var er=Object.prototype,nr=er.hasOwnProperty,or=er.propertyIsEnumerable,ir=rr(function(){return arguments}())?rr:function(t){return b(t)&&nr.call(t,"callee")&&!or.call(t,"callee")},ur=ir;var ar="object"==typeof exports&&exports&&!exports.nodeType&&exports,cr=ar&&"object"==typeof module&&module&&!module.nodeType&&module,fr=cr&&cr.exports===ar?a.Buffer:void 0,sr=(fr?fr.isBuffer:void 0)||function(){return!1},lr={};function pr(t){return function(r){return t(r)}}lr["[object Float32Array]"]=lr["[object Float64Array]"]=lr["[object Int8Array]"]=lr["[object Int16Array]"]=lr["[object Int32Array]"]=lr["[object Uint8Array]"]=lr["[object Uint8ClampedArray]"]=lr["[object Uint16Array]"]=lr["[object Uint32Array]"]=!0,lr["[object Arguments]"]=lr["[object Array]"]=lr["[object ArrayBuffer]"]=lr["[object Boolean]"]=lr["[object DataView]"]=lr["[object Date]"]=lr["[object Error]"]=lr["[object Function]"]=lr["[object Map]"]=lr["[object Number]"]=lr["[object Object]"]=lr["[object RegExp]"]=lr["[object Set]"]=lr["[object String]"]=lr["[object WeakMap]"]=!1;var hr="object"==typeof exports&&exports&&!exports.nodeType&&exports,dr=hr&&"object"==typeof module&&module&&!module.nodeType&&module,yr=dr&&dr.exports===hr&&i.process,vr=function(){try{var t=dr&&dr.require&&dr.require("util").types;return t||yr&&yr.binding&&yr.binding("util")}catch(t){}}(),gr=vr&&vr.isTypedArray,br=gr?pr(gr):function(t){return b(t)&&qt(t.length)&&!!lr[g(t)]},_r=Object.prototype.hasOwnProperty;function jr(t,r){var e=o(t),n=!e&&ur(t),i=!e&&!n&&sr(t),u=!e&&!n&&!i&&br(t),a=e||n||i||u,c=a?function(t,r){for(var e=-1,n=Array(t);++e<t;)n[e]=r(e);return n}(t.length,String):[],f=c.length;for(var s in t)!r&&!_r.call(t,s)||a&&("length"==s||i&&("offset"==s||"parent"==s)||u&&("buffer"==s||"byteLength"==s||"byteOffset"==s)||Gt(s,f))||c.push(s);return c}var mr=Object.prototype;var wr=function(t,r){return function(e){return t(r(e))}}(Object.keys,Object),Ar=wr,Or=Object.prototype.hasOwnProperty;function xr(t){if(e=(r=t)&&r.constructor,r!==("function"==typeof e&&e.prototype||mr))return Ar(t);var r,e,n=[];for(var o in Object(t))Or.call(t,o)&&"constructor"!=o&&n.push(o);return n}function Sr(t){return Dt(t)?jr(t):xr(t)}var Ur=function(t,r){return function(e,n){if(null==e)return e;if(!Dt(e))return t(e,n);for(var o=e.length,i=r?o:-1,u=Object(e);(r?i--:++i<o)&&!1!==n(u[i],i,u););return e}}((function(t,r){return t&&tr(t,r,Sr)})),Br=Ur;function zr(t){return t}function Tr(t,r){var e;return(o(t)?Yt:Br)(t,"function"==typeof(e=r)?e:zr)}let Er="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Cr=Er.length;function Ir(t){return"[object Uint8Array]"===Object.prototype.toString.call(t)}function Pr(t){return"[object Uint16Array]"===Object.prototype.toString.call(t)}function $r(t){if(!It(t))return!1;return Ft(t)>=0}function Mr(t,r){return Tt(t)&&$r(r)?0===(r=Ft(r))?"":t.substring(0,r):""}function kr(t,r){return Tt(t)&&$r(r)?0===(r=Ft(r))?t:function(t,r){if(!Tt(t))return"";if(!$r(r))return"";if(0===(r=Ft(r)))return"";let e=t.length-r;return e<0&&(e=0),t.substr(e,r)}(t,t.length-r):""}var Fr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Rr(t){if(t.__esModule)return t;var r=t.default;if("function"==typeof r){var e=function t(){if(this instanceof t){var e=[null];return e.push.apply(e,arguments),new(Function.bind.apply(r,e))}return r.apply(this,arguments)};e.prototype=r.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(t).forEach((function(r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})})),e}var Nr={},Hr={get exports(){return Nr},set exports(t){Nr=t}};var qr,Dr={},Lr={get exports(){return Dr},set exports(t){Dr=t}},Wr=Rr(Object.freeze({__proto__:null,default:{}}));function Gr(){return qr||(qr=1,function(t,r){var e;t.exports=(e=e||function(t,r){var e;if("undefined"!=typeof window&&window.crypto&&(e=window.crypto),"undefined"!=typeof self&&self.crypto&&(e=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(e=globalThis.crypto),!e&&"undefined"!=typeof window&&window.msCrypto&&(e=window.msCrypto),!e&&void 0!==Fr&&Fr.crypto&&(e=Fr.crypto),!e)try{e=Wr}catch(t){}var n=function(){if(e){if("function"==typeof e.getRandomValues)try{return e.getRandomValues(new Uint32Array(1))[0]}catch(t){}if("function"==typeof e.randomBytes)try{return e.randomBytes(4).readInt32LE()}catch(t){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function t(){}return function(r){var e;return t.prototype=r,e=new t,t.prototype=null,e}}(),i={},u=i.lib={},a=u.Base={extend:function(t){var r=o(this);return t&&r.mixIn(t),r.hasOwnProperty("init")&&this.init!==r.init||(r.init=function(){r.$super.init.apply(this,arguments)}),r.init.prototype=r,r.$super=this,r},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},c=u.WordArray=a.extend({init:function(t,e){t=this.words=t||[],this.sigBytes=e!=r?e:4*t.length},toString:function(t){return(t||s).stringify(this)},concat:function(t){var r=this.words,e=t.words,n=this.sigBytes,o=t.sigBytes;if(this.clamp(),n%4)for(var i=0;i<o;i++){var u=e[i>>>2]>>>24-i%4*8&255;r[n+i>>>2]|=u<<24-(n+i)%4*8}else for(var a=0;a<o;a+=4)r[n+a>>>2]=e[a>>>2];return this.sigBytes+=o,this},clamp:function(){var r=this.words,e=this.sigBytes;r[e>>>2]&=4294967295<<32-e%4*8,r.length=t.ceil(e/4)},clone:function(){var t=a.clone.call(this);return t.words=this.words.slice(0),t},random:function(t){for(var r=[],e=0;e<t;e+=4)r.push(n());return new c.init(r,t)}}),f=i.enc={},s=f.Hex={stringify:function(t){for(var r=t.words,e=t.sigBytes,n=[],o=0;o<e;o++){var i=r[o>>>2]>>>24-o%4*8&255;n.push((i>>>4).toString(16)),n.push((15&i).toString(16))}return n.join("")},parse:function(t){for(var r=t.length,e=[],n=0;n<r;n+=2)e[n>>>3]|=parseInt(t.substr(n,2),16)<<24-n%8*4;return new c.init(e,r/2)}},l=f.Latin1={stringify:function(t){for(var r=t.words,e=t.sigBytes,n=[],o=0;o<e;o++){var i=r[o>>>2]>>>24-o%4*8&255;n.push(String.fromCharCode(i))}return n.join("")},parse:function(t){for(var r=t.length,e=[],n=0;n<r;n++)e[n>>>2]|=(255&t.charCodeAt(n))<<24-n%4*8;return new c.init(e,r)}},p=f.Utf8={stringify:function(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(t){return l.parse(unescape(encodeURIComponent(t)))}},h=u.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=p.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(r){var e,n=this._data,o=n.words,i=n.sigBytes,u=this.blockSize,a=i/(4*u),f=(a=r?t.ceil(a):t.max((0|a)-this._minBufferSize,0))*u,s=t.min(4*f,i);if(f){for(var l=0;l<f;l+=u)this._doProcessBlock(o,l);e=o.splice(0,f),n.sigBytes-=s}return new c.init(e,s)},clone:function(){var t=a.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});u.Hasher=h.extend({cfg:a.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(r,e){return new t.init(e).finalize(r)}},_createHmacHelper:function(t){return function(r,e){return new d.HMAC.init(t,e).finalize(r)}}});var d=i.algo={};return i}(Math),e)}(Lr)),Dr}!function(t,r){var e;t.exports=(e=Gr(),function(){var t=e,r=t.lib.WordArray;function n(t,e,n){for(var o=[],i=0,u=0;u<e;u++)if(u%4){var a=n[t.charCodeAt(u-1)]<<u%4*2|n[t.charCodeAt(u)]>>>6-u%4*2;o[i>>>2]|=a<<24-i%4*8,i++}return r.create(o,i)}t.enc.Base64={stringify:function(t){var r=t.words,e=t.sigBytes,n=this._map;t.clamp();for(var o=[],i=0;i<e;i+=3)for(var u=(r[i>>>2]>>>24-i%4*8&255)<<16|(r[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|r[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<e;a++)o.push(n.charAt(u>>>6*(3-a)&63));var c=n.charAt(64);if(c)for(;o.length%4;)o.push(c);return o.join("")},parse:function(t){var r=t.length,e=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<e.length;i++)o[e.charCodeAt(i)]=i}var u=e.charAt(64);if(u){var a=t.indexOf(u);-1!==a&&(r=a)}return n(t,r,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),e.enc.Base64)}(Hr);var Vr=Nr,Jr={};!function(t,r){var e;t.exports=(e=Gr(),function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init,n=t.init=function(t){if(t instanceof ArrayBuffer&&(t=new Uint8Array(t)),(t instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array||t instanceof Float64Array)&&(t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength)),t instanceof Uint8Array){for(var e=t.byteLength,n=[],o=0;o<e;o++)n[o>>>2]|=t[o]<<24-o%4*8;r.call(this,n,e)}else r.apply(this,arguments)};n.prototype=t}}(),e.lib.WordArray)}({get exports(){return Jr},set exports(t){Jr=t}});var Kr=Jr;function Qr(t){if(!Ir(t))return"";return Kr.create(t).toString(Vr)}function Xr(t){if(!zt(t))return new Uint8Array;let r=Vr.parse(t),e=r.words,n=r.sigBytes,o=new Uint8Array(n);for(let t=0;t<n;t++){let r=e[t>>>2]>>>24-t%4*8&255;o[t]=r}return o}function Yr(t){return Pr(t)?Qr(function(t){return Pr(t)?new Uint8Array(t):new Uint8Array}(t)):""}function Zr(t){if(!zt(t))return new Uint16Array;let r=function(t){return Ir(t)?new Uint16Array(t):new Uint16Array}(Xr(t));return r}let te="[Uint8Array]::";let re="[Uint16Array]::";let ee={tagU8A:te,u8arr2b64:function(t){return Ir(t)?te+Qr(t):t},b642u8arr:function(t){return zt(t)&&Mr(t,te.length)===te?Xr(t=kr(t,te.length)):t},tagU16A:re,u16arr2b64:function(t){return Pr(t)?re+Yr(t):t},b642u16arr:function(t){return zt(t)&&Mr(t,re.length)===re?Zr(t=kr(t,re.length)):t}};function ne(t){return"[object Array]"===Object.prototype.toString.call(t)}function oe(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(e=t,"[object Undefined]"===Object.prototype.toString.call(e))return"";var e;if(zt(r))r=[r];else if(!ne(r))return"";let n="";try{n=JSON.stringify(t,(function(t,e){return r.indexOf("Uint8Array")>=0&&(e=ee.u8arr2b64(e)),r.indexOf("Uint16Array")>=0&&(e=ee.u16arr2b64(e)),e}))}catch(t){n=""}return n}function ie(t,r,e,n,o){let i=function(t,r,e){r=(e?Vt(t,r,e):void 0===r)?1:Kt(Bt(r),0);var n=null==t?0:t.length;if(!n||r<1)return[];for(var o=0,i=0,u=Array(Jt(n/r));o<n;)u[i++]=Nt(t,o,o+=r);return u}(oe(e),r),u=function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:32,r=[];t=Rt(t)?Ft(t):32;for(let e=0;e<t;e++)r[e]=Er[0|Math.random()*Cr];return r.join("")}(),a=i.length;Tr(i,(function(r,e){r=Xt(r,"");let i=`${u}|${e}|${a}|${r}`;t.send(i,(function(t){t&&B(o)&&o(t)})),B(n)&&n((e+1)/a*100)}))}var ue=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");function ae(t){return ue.test(t)}var ce=vr&&vr.isRegExp,fe=ce?pr(ce):function(t){return b(t)&&"[object RegExp]"==g(t)};var se="\\ud800-\\udfff",le="["+se+"]",pe="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",he="\\ud83c[\\udffb-\\udfff]",de="[^"+se+"]",ye="(?:\\ud83c[\\udde6-\\uddff]){2}",ve="[\\ud800-\\udbff][\\udc00-\\udfff]",ge="(?:"+pe+"|"+he+")"+"?",be="[\\ufe0e\\ufe0f]?",_e=be+ge+("(?:\\u200d(?:"+[de,ye,ve].join("|")+")"+be+ge+")*"),je="(?:"+[de+pe+"?",pe,ye,ve,le].join("|")+")",me=RegExp(he+"(?="+he+")|"+je+_e,"g");function we(t){return ae(t)?function(t){return t.match(me)||[]}(t):function(t){return t.split("")}(t)}var Ae=4294967295;function Oe(t,r,e){return e&&"number"!=typeof e&&Vt(t,r,e)&&(r=e=void 0),(e=void 0===e?Ae:e>>>0)?(t=lt(t))&&("string"==typeof r||null!=r&&!fe(r))&&!(r=st(r))&&ae(t)?(n=we(t),o=0,i=e,u=n.length,i=void 0===i?u:i,!o&&i>=u?n:Nt(n,o,i)):t.split(r,e):[];var n,o,i,u}var xe=Math.ceil,Se=Math.max;var Ue=function(t){return function(r,e,n){return n&&"number"!=typeof n&&Vt(r,e,n)&&(e=n=void 0),r=Ut(r),void 0===e?(e=r,r=0):e=Ut(e),function(t,r,e,n){for(var o=-1,i=Se(xe((r-t)/(e||1)),0),u=Array(i);i--;)u[n?i:++o]=t,t+=e;return u}(r,e,n=void 0===n?r<e?1:-1:Ut(n),t)}}(),Be=Ue;function ze(t,r){return e=t,"[object Object]"===Object.prototype.toString.call(e)&&(!(!Tt(r)&&!Et(r))&&r in t);var e}let Te={};function Ee(t,r){let e=Oe(t,"|"),n=e[0],o=Ot(e[1]),i=Ot(e[2]),u=Xt((c=3,(s=null==(a=e)?0:a.length)?Nt(a,(c=f||void 0===c?1:Bt(c))<0?0:c,s):[]),"|");var a,c,f,s;if(ze(Te,n)||(Te[n]={}),Te[n]["_"+o]=u,o===i-1){let t="";Tr(Be(i),(function(r){t+=Te[n]["_"+r]})),delete Te[n];let e=function(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Uint8Array";if(zt(r))r=[r];else if(!ne(r))return{};let e={};try{e=JSON.parse(t,(function(t,e){return r.indexOf("Uint8Array")>=0&&(e=ee.b642u8arr(e)),r.indexOf("Uint16Array")>=0&&(e=ee.b642u16arr(e)),e}))}catch(t){e={}}return e}(t);r(e)}}let Ce=e.Server;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=yt(e,"port");Rt(o)||(o=8080),o=Ft(o);let i=yt(e,"pathPolling"),u=yt(e,"strSplitLength");Rt(u)||(u=1e6);let a,c=new n.EventEmitter;function f(t){for(var r=arguments.length,e=new Array(r>1?r-1:0),n=1;n<r;n++)e[n-1]=arguments[n];setTimeout((()=>{c.emit(t,...e)}),1)}a=e.serverHapi?e.serverHapi:t.server({port:e.port,routes:{cors:!0}});let s=null,l={};Tt(i)&&(l={path:i});try{s=new Ce(a.listener,l)}catch(t){return p("create SocketIO catch error",t),c}if(!s)return p("can not create SocketIO","io from SocketIO is null"),c;function p(t,r){f("error",{msg:t,err:r})}function h(){f("clientChange",d)}f("open");let d=[];return s.on("connect",(function(t){function r(r,e){try{ie(t,u,r,e,(function(t){p("can not send message",t)}))}catch(t){p("send message catch error",t)}}function e(t){let e=yt(t,"_mode","");if("execute"===e){f("execute",yt(t,"func",""),yt(t,"input"),(function(e){t.output=e,delete t.input,r(t,null)}),r)}else"broadcast"===e?f("broadcast",yt(t,"data")):"deliver"===e?f("deliver",yt(t,"data")):p("can not find _mode in data",t)}d.push(t.id),h(),t.sendData=r,t.on("message",(function(t){Ee(t,e)})),t.on("disconnect",(function(r){d=d.filter((function(r){return r!==t.id})),h()})),c.on("triggerBroadcast",(function(t,e){r({_mode:"broadcast",data:t},e)}))})),c.broadcast=function(t){f("triggerBroadcast",t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){})},e.serverHapi||async function(){await a.register(r),a.route([{method:"GET",path:"/web.html",handler:{file:{path:"./web.html"}}},{method:"GET",path:"/dist/w-conversi-client.umd.js",handler:{file:{path:"./dist/w-conversi-client.umd.js"}}},{method:"GET",path:"/dist/w-conversi-client.umd.js.map",handler:{file:{path:"./dist/w-conversi-client.umd.js.map"}}}]),await a.start(),console.log(`Server running at: ${a.info.uri}`)}(),c}}));
//# sourceMappingURL=w-conversi-server.umd.js.map
